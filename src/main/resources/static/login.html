<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iniciar sesión — Stark Industries</title>
    <link rel="stylesheet" href="css/login.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
</head>
<body>
<main class="auth">
    <section class="card" role="form" aria-labelledby="login-title">
        <header class="card__header">
            <h1 id="login-logo">STARK <span>INDUSTRIES</span></h1>
            <h1 id="login-title">Iniciar sesión en el Panel de Sensores</h1>
            <p class="subtitle">Accede con tus credenciales corporativas</p>
        </header>

        <!-- Mensajes dinámicos -->
        <div id="msg" class="msg" role="status" aria-live="polite"></div>

        <form action="/auth/login" method="post" novalidate>
            <!-- CSRF (si tu backend lo usa) -->
            <input type="hidden" name="_csrf" value="{{csrfToken}}">

            <div class="field">
                <label for="username">Usuario</label>
                <input
                        id="username"
                        name="username"
                        type="text"
                        placeholder="tu.usuario"
                        inputmode="text"
                        autocomplete="username"
                        required
                />
            </div>

            <div class="field">
                <label for="password">Contraseña</label>
                <div class="password-wrap">
                    <input
                            id="password"
                            name="password"
                            type="password"
                            placeholder="••••••••"
                            autocomplete="current-password"
                            required
                            minlength="6"
                    />
                    <button type="button" class="toggle" aria-label="Mostrar u ocultar contraseña">
                        👁️
                    </button>
                </div>
            </div>

            <div class="row">
                <label class="checkbox">
                    <input type="checkbox" name="remember" value="true" />
                    <span>Recordarme</span>
                </label>
                <a class="link" href="/auth/forgot">¿Olvidaste tu contraseña?</a>
            </div>

            <button type="submit" class="btn btn--primary">Entrar</button>
        </form>

        <footer class="card__footer">
            <p class="muted">
                © <span id="year"></span> Stark Industries · Seguridad de acceso habilitada
            </p>
        </footer>
    </section>
</main>

<script>
    // Mensajes por querystring (?error, ?logout, ?blocked, etc.)
    (function () {
      const params = new URLSearchParams(window.location.search);
      const msg = document.getElementById('msg');
      if (!msg) return;

      if (params.has('error')) {
        msg.textContent = '⚠️ Usuario o contraseña incorrectos';
        msg.classList.add('msg--error');
      } else if (params.has('logout')) {
        msg.textContent = '✅ Has cerrado sesión correctamente';
        msg.classList.add('msg--ok');
      } else if (params.has('blocked')) {
        msg.textContent = '⛔ Cuenta bloqueada temporalmente por múltiples intentos';
        msg.classList.add('msg--error');
      }
    })();

    // Mostrar/ocultar contraseña
    (function () {
      const btn = document.querySelector('.toggle');
      const input = document.getElementById('password');
      if (!btn || !input) return;

      btn.addEventListener('click', () => {
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        btn.setAttribute('aria-pressed', isPwd ? 'true' : 'false');
      });
    })();

    // Año dinámico
    document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
